<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">
  
  <!-- Web App iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Mente Sã">
  <meta name="application-name" content="Mente Sã">
  <meta name="theme-color" content="#2a6451">
  <meta name="description" content="Plataforma de saúde mental e bem-estar emocional">
  <meta name="format-detection" content="telephone=no">
  
  <!-- Ícones para iOS -->
  <link rel="apple-touch-icon" href="/icons/apple-icon-180.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/icons/apple-icon-167.png">
  
  <!-- Telas de inicialização para iOS -->
  <link rel="apple-touch-startup-image" href="/splash/apple-splash-2048-2732.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="/splash/apple-splash-1668-2388.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="/splash/apple-splash-1536-2048.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="/splash/apple-splash-1125-2436.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="/splash/apple-splash-1242-2688.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="/splash/apple-splash-750-1334.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="/splash/apple-splash-640-1136.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  
  <!-- Web App Manifest -->
  <link rel="manifest" href="/manifest.json">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  
  <title>Login - Mente Sã</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    }
    
    body {
      background-color: #f4fff6;
      color: #1f2937;
      line-height: 1.6;
      min-height: 100vh;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }
    
    .container {
      max-width: 400px;
      margin: 40px auto;
      padding: 20px;
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    h1 {
      color: #2a6451;
      margin-bottom: 10px;
      font-size: 1.8rem;
    }
    
    .logo {
      width: 80px;
      height: 80px;
      margin: 0 auto 20px;
      display: block;
      background-color: #2a6451;
      border-radius: 50%;
      position: relative;
    }
    
    .logo::after {
      content: "MS";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-weight: bold;
      font-size: 1.8rem;
    }
    
    .button {
      display: block;
      width: 100%;
      padding: 15px;
      margin-bottom: 15px;
      background-color: #2a6451;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      text-align: center;
      transition: background-color 0.2s;
      -webkit-appearance: none;
      appearance: none;
    }
    
    .button:hover, .button:active {
      background-color: #1f4d3d;
    }
    
    .secondary {
      background-color: #e1f5ed;
      color: #2a6451;
    }
    
    .secondary:hover, .secondary:active {
      background-color: #c9eadd;
    }
    
    .result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      background-color: #e1f5ed;
      display: none;
    }
    
    .result.error {
      background-color: #fde8e8;
      color: #b91c1c;
    }
    
    .result.success {
      background-color: #d1fae5;
      color: #047857;
    }
    
    footer {
      text-align: center;
      margin-top: 30px;
      font-size: 0.8rem;
      color: #6b7280;
    }
    
    .app-notice {
      text-align: center;
      margin-top: 30px;
      padding: 10px;
      background-color: #e1f5ed;
      border-radius: 8px;
      font-size: 0.9rem;
    }
    
    .app-notice p {
      margin-bottom: 10px;
    }
    
    .app-notice strong {
      color: #2a6451;
    }
    
    @media (max-width: 480px) {
      .container {
        margin: 20px 15px;
      }
    }

    /* Adicionar animações suaves */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .container {
      animation: fadeIn 0.5s ease-out;
    }
    
    .button {
      transition: transform 0.1s ease-in-out, background-color 0.2s;
    }
    
    .button:active {
      transform: scale(0.98);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo"></div>
      <h1>Mente Sã</h1>
      <p>Plataforma de saúde mental</p>
    </div>
    
    <button id="loginPatient" class="button">Entrar como Paciente</button>
    <button id="loginTherapist" class="button secondary">Entrar como Terapeuta</button>
    
    <div id="result" class="result"></div>
    
    <div class="app-notice">
      <p><strong>Dica:</strong> No iOS, adicione à tela inicial para usar como aplicativo!</p>
      <p>Toque em <strong>compartilhar</strong> <span style="font-size: 1.2em">⌘</span> e selecione <strong>"Adicionar à Tela de Início"</strong></p>
    </div>
  </div>
  
  <footer>
    &copy; 2025 Mente Sã - Todos os direitos reservados
  </footer>
  
  <script>
    const resultEl = document.getElementById('result');
    
    function showResult(message, isSuccess = true) {
      resultEl.textContent = message;
      resultEl.style.display = 'block';
      
      if (isSuccess) {
        resultEl.classList.add('success');
        resultEl.classList.remove('error');
      } else {
        resultEl.classList.add('error');
        resultEl.classList.remove('success');
      }
    }
    
    document.getElementById('loginPatient').addEventListener('click', async () => {
      try {
        showResult('Fazendo login como paciente...');
        
        const response = await fetch('/api/login-teste', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });
        
        const data = await response.json();
        
        if (data.token) {
          localStorage.setItem('authToken', data.token);
          showResult('Login como paciente realizado com sucesso! Redirecionando...');
          
          setTimeout(() => {
            window.location.href = `/?nocache=${Date.now()}`;
          }, 1000);
        } else {
          showResult('Erro: Não foi possível obter o token de autenticação', false);
        }
      } catch (error) {
        showResult(`Erro: ${error.message}`, false);
      }
    });
    
    document.getElementById('loginTherapist').addEventListener('click', async () => {
      try {
        showResult('Fazendo login como terapeuta...');
        
        const response = await fetch('/api/login-terapeuta', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });
        
        const data = await response.json();
        
        if (data.token) {
          localStorage.setItem('authToken', data.token);
          showResult('Login como terapeuta realizado com sucesso! Redirecionando...');
          
          setTimeout(() => {
            window.location.href = `/therapist-dashboard?nocache=${Date.now()}`;
          }, 1000);
        } else {
          showResult('Erro: Não foi possível obter o token de autenticação', false);
        }
      } catch (error) {
        showResult(`Erro: ${error.message}`, false);
      }
    });

    // Verificar se está sendo executado como um aplicativo iOS
    window.addEventListener('load', () => {
      const isInStandaloneMode = window.navigator.standalone;
      const appNotice = document.querySelector('.app-notice');
      
      if (isInStandaloneMode) {
        appNotice.style.display = 'none';
      }
      
      // Detectar iOS
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
      
      if (!isIOS) {
        appNotice.style.display = 'none';
      }
    });
  </script>
</body>
</html>