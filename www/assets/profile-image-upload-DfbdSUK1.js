import{c as y,b as E,r as m,j as e,B as g,J as x,I as F}from"./index-DKFI7ZyH.js";import{A as q,b as A,a as I}from"./avatar-Dqs0JyeB.js";import{T as S}from"./trash-2-CpzcPU4s.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=y("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=y("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);function M({currentImage:l,userName:d,onImageUpdated:s,size:j="md",showButtons:w=!0}){const{toast:r}=E(),[n,u]=m.useState(!1),[c,p]=m.useState(!1),i=m.useRef(null),k={sm:"h-16 w-16",md:"h-24 w-24",lg:"h-32 w-32",xl:"h-40 w-40"},N=a=>a?a.split(" ").map(t=>t[0]).join("").toUpperCase().substring(0,2):"?",f=()=>{i.current&&i.current.click()},b=async a=>{var h;const t=(h=a.target.files)==null?void 0:h[0];if(t){if(!t.type.startsWith("image/")){r({title:"Tipo de arquivo não suportado",description:"Por favor, selecione uma imagem (JPG, PNG, etc.)",variant:"destructive"});return}if(t.size>5*1024*1024){r({title:"Arquivo muito grande",description:"A imagem deve ter no máximo 5MB",variant:"destructive"});return}try{u(!0);const o=new FormData;o.append("profileImage",t);const v=await fetch("/api/profile-image/upload",{method:"POST",body:o,headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(!v.ok)throw new Error("Falha ao fazer upload da imagem");const C=await v.json();x.invalidateQueries({queryKey:["/api/user"]}),s&&s(C.imageUrl),r({title:"Imagem atualizada",description:"Sua foto de perfil foi atualizada com sucesso"})}catch(o){console.error("Erro ao fazer upload da imagem:",o),r({title:"Erro ao atualizar imagem",description:"Não foi possível fazer o upload da imagem",variant:"destructive"})}finally{u(!1),i.current&&(i.current.value="")}}},z=async()=>{if(l)try{if(p(!0),!(await F("DELETE","/api/profile-image/delete")).ok)throw new Error("Falha ao remover a imagem");x.invalidateQueries({queryKey:["/api/user"]}),s&&s(""),r({title:"Imagem removida",description:"Sua foto de perfil foi removida com sucesso"})}catch(a){console.error("Erro ao remover a imagem:",a),r({title:"Erro ao remover imagem",description:"Não foi possível remover a foto de perfil",variant:"destructive"})}finally{p(!1)}};return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("input",{type:"file",ref:i,onChange:b,accept:"image/*",className:"hidden"}),e.jsx("div",{className:"relative group",children:e.jsxs(q,{className:`${k[j]} ring-4 ring-white shadow-md cursor-pointer transition-opacity duration-300 group-hover:opacity-80`,onClick:f,children:[e.jsx(A,{src:l||"",alt:d,className:"object-cover"}),e.jsx(I,{className:"text-2xl bg-primary text-primary-foreground",children:N(d)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40 opacity-0 group-hover:opacity-100 rounded-full transition-opacity",children:e.jsx(T,{className:"h-6 w-6 text-white"})})]})}),w&&e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(g,{variant:"outline",size:"sm",onClick:f,disabled:n||c,children:n?e.jsx(e.Fragment,{children:"Enviando..."}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),"Alterar foto"]})}),l&&e.jsx(g,{variant:"outline",size:"sm",onClick:z,disabled:n||c,className:"text-destructive hover:bg-destructive/10",children:c?e.jsx(e.Fragment,{children:"Removendo..."}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Remover"]})})]})]})}export{M as P};
