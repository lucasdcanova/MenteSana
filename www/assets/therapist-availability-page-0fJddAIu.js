import{b3 as p,b as O,r as N,y as z,aR as W,z as S,j as e,C as D,f as F,aT as A,g as k,h as P,aU as I,aV as j,aW as g,aX as f,aY as v,aZ as y,a_ as K,a$ as Q,B as C,A as E,E as H,b0 as B,aN as R,aS as G,I as b,J as q,K as U,u as J,k as X,bd as Y}from"./index-DKFI7ZyH.js";import{S as Z,a as _,b as ee,c as ae,d as se}from"./select-DV2zMmnw.js";import{S as L}from"./switch-Cz62NSvB.js";import{C as ie}from"./calendar-35st2irS.js";import{T as re}from"./trash-2-CpzcPU4s.js";import{C as ne}from"./circle-check-C5HjS40s.js";import{T as te}from"./triangle-alert-D-ap9A30.js";import{T as oe,a as de,b as M,c as V}from"./tabs-BarOwXjl.js";import"./chevron-down-VAhjCEtL.js";import"./isSameDay-BgnmRS2q.js";import"./addDays--7OLxFs-.js";import"./endOfMonth-D7azNT7e.js";import"./isBefore-Dqtm-g72.js";import"./chevron-right-Bo6uQhrt.js";const $=[{id:0,name:"Domingo"},{id:1,name:"Segunda-feira"},{id:2,name:"Terça-feira"},{id:3,name:"Quarta-feira"},{id:4,name:"Quinta-feira"},{id:5,name:"Sexta-feira"},{id:6,name:"Sábado"}],ce=p.object({dayOfWeek:p.string().min(1,"Escolha um dia da semana"),startTime:p.string().min(1,"Horário de início é obrigatório"),endTime:p.string().min(1,"Horário de término é obrigatório"),isRecurring:p.boolean().default(!0),specificDate:p.date().nullable().optional()});function le({therapistId:s}){const{toast:o}=O(),[r,x]=N.useState([]),{data:l,isLoading:w,error:m}=z({queryKey:["/api/therapist-availability",s],queryFn:async()=>await(await b("GET",`/api/therapist-availability/${s}`)).json()});N.useEffect(()=>{l&&x(l)},[l]);const n=W({resolver:G(ce),defaultValues:{dayOfWeek:"",startTime:"",endTime:"",isRecurring:!0,specificDate:null}}),i=S({mutationFn:async a=>{const t={...a,dayOfWeek:parseInt(a.dayOfWeek),specificDate:a.specificDate?E(a.specificDate,"yyyy-MM-dd"):null},c=await b("POST","/api/therapist-availability",t);if(!c.ok){const T=await c.json();throw new Error(T.error||"Erro ao criar disponibilidade")}return await c.json()},onSuccess:()=>{o({title:"Disponibilidade adicionada",description:"Sua disponibilidade foi adicionada com sucesso."}),q.invalidateQueries({queryKey:["/api/therapist-availability",s]}),n.reset()},onError:a=>{o({title:"Erro ao adicionar disponibilidade",description:a.message,variant:"destructive"})}}),d=S({mutationFn:async a=>{if(!(await b("DELETE",`/api/therapist-availability/${a}`)).ok)throw new Error("Erro ao excluir disponibilidade");return a},onSuccess:a=>{o({title:"Disponibilidade removida",description:"A disponibilidade foi removida com sucesso."}),x(t=>t.filter(c=>c.id!==a)),q.invalidateQueries({queryKey:["/api/therapist-availability",s]})},onError:a=>{o({title:"Erro ao remover disponibilidade",description:a.message,variant:"destructive"})}});function h(a){if(!a.isRecurring&&!a.specificDate){o({title:"Data específica necessária",description:"Por favor, selecione uma data específica para disponibilidade não recorrente.",variant:"destructive"});return}i.mutate(a)}const u=a=>{var c;return`${a.isRecurring?(c=$.find(T=>T.id===a.dayOfWeek))==null?void 0:c.name:E(new Date(a.specificDate),"dd/MM/yyyy",{locale:U})}, ${a.startTime} - ${a.endTime}`};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(D,{children:[e.jsxs(F,{children:[e.jsx(A,{children:"Definir Disponibilidade"}),e.jsx(k,{children:"Configure os horários em que você está disponível para consultas."})]}),e.jsx(P,{children:e.jsx(I,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(h),className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{control:n.control,name:"isRecurring",render:({field:a})=>e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(f,{children:"Recorrente"}),e.jsx(v,{children:e.jsx(L,{checked:a.value,onCheckedChange:a.onChange})})]})}),e.jsx("span",{className:"text-sm text-muted-foreground",children:n.watch("isRecurring")?"Disponibilidade semanal":"Data específica"})]}),n.watch("isRecurring")?e.jsx(j,{control:n.control,name:"dayOfWeek",render:({field:a})=>e.jsxs(g,{children:[e.jsx(f,{children:"Dia da Semana"}),e.jsxs(Z,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(v,{children:e.jsx(_,{children:e.jsx(ee,{placeholder:"Selecione um dia da semana"})})}),e.jsx(ae,{children:$.map(t=>e.jsx(se,{value:t.id.toString(),children:t.name},t.id))})]}),e.jsx(y,{})]})}):e.jsx(j,{control:n.control,name:"specificDate",render:({field:a})=>e.jsxs(g,{className:"flex flex-col",children:[e.jsx(f,{children:"Data Específica"}),e.jsxs(K,{children:[e.jsx(Q,{asChild:!0,children:e.jsx(v,{children:e.jsxs(C,{variant:"outline",className:`w-full pl-3 text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?E(a.value,"PPP",{locale:U}):e.jsx("span",{children:"Selecione uma data"}),e.jsx(H,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(B,{className:"w-auto p-0",align:"start",children:e.jsx(ie,{mode:"single",selected:a.value||void 0,onSelect:a.onChange,disabled:t=>t<new Date,initialFocus:!0})})]}),e.jsx(y,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(j,{control:n.control,name:"startTime",render:({field:a})=>e.jsxs(g,{children:[e.jsx(f,{children:"Horário de Início"}),e.jsx(v,{children:e.jsx(R,{type:"time",...a})}),e.jsx(y,{})]})}),e.jsx(j,{control:n.control,name:"endTime",render:({field:a})=>e.jsxs(g,{children:[e.jsx(f,{children:"Horário de Término"}),e.jsx(v,{children:e.jsx(R,{type:"time",...a})}),e.jsx(y,{})]})})]}),e.jsx(C,{type:"submit",className:"w-full",disabled:i.isPending,children:i.isPending?"Adicionando...":"Adicionar Disponibilidade"})]})})})]}),e.jsxs(D,{children:[e.jsxs(F,{children:[e.jsx(A,{children:"Disponibilidades Atuais"}),e.jsx(k,{children:"Seus horários disponíveis para atendimento."})]}),e.jsx(P,{children:w?e.jsx("div",{className:"text-center py-4",children:"Carregando disponibilidades..."}):m?e.jsx("div",{className:"text-center py-4 text-red-500",children:"Erro ao carregar disponibilidades"}):r.length===0?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Nenhuma disponibilidade encontrada"}):e.jsx("ul",{className:"space-y-2",children:r.map(a=>e.jsxs("li",{className:"flex justify-between items-center p-3 border rounded-md",children:[e.jsx("span",{children:u(a)}),e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>d.mutate(a.id),disabled:d.isPending,children:e.jsx(re,{className:"h-4 w-4 text-destructive"})})]},a.id))})})]})]})}function me({therapistId:s}){const{toast:o}=O(),[r,x]=N.useState(!1),{data:l,isLoading:w}=z({queryKey:["/api/therapist-urgency-status",s],queryFn:async()=>{try{const i=await b("GET",`/api/therapist-urgency-status/${s}`);if(!i.ok)throw new Error("Erro ao buscar status de disponibilidade");const d=await i.json();return console.log("Status de urgência recebido:",d),d}catch(i){return console.error("Erro ao buscar status de urgência:",i),{id:0,therapistId:s,isAvailableForUrgent:!1}}},retry:1});N.useEffect(()=>{l&&x(l.isAvailableForUrgent)},[l]);const m=S({mutationFn:async i=>{const d={therapistId:s,isAvailableForUrgent:i};console.log("Enviando payload:",d);const h=await b("POST","/api/therapist-urgency-status",d);if(!h.ok){const u=await h.json().catch(()=>null);throw console.error("Erro na resposta da API:",u),new Error((u==null?void 0:u.error)||"Erro ao atualizar status de urgência")}return await h.json()},onSuccess:i=>{x(i.isAvailableForUrgent);const d=i.isAvailableForUrgent?"Você está disponível para atendimentos de urgência":"Você não está mais disponível para atendimentos de urgência";o({title:"Status atualizado",description:d}),q.invalidateQueries({queryKey:["/api/therapist-urgency-status",s]})},onError:i=>{o({title:"Erro ao atualizar status",description:i.message,variant:"destructive"})}}),n=()=>{console.log("Toggle clicado, valor atual:",r,"alterando para:",!r),m.mutate(!r)};return e.jsxs(D,{children:[e.jsxs(F,{children:[e.jsx(A,{children:"Disponibilidade para Urgências"}),e.jsx(k,{children:"Indique se você está disponível para atender consultas de urgência."})]}),e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[r?e.jsx(ne,{className:"h-6 w-6 text-green-500"}):e.jsx(te,{className:"h-6 w-6 text-amber-500"}),e.jsx("span",{className:"font-medium",children:r?"Disponível para urgências":"Indisponível para urgências"})]}),e.jsx(L,{checked:r,onCheckedChange:n,disabled:w||m.isPending})]}),r&&e.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-100 rounded-md text-sm text-green-800",children:"Pacientes com necessidades urgentes poderão solicitar atendimento imediato com você."}),m.isError&&e.jsxs("div",{className:"mt-4 p-3 bg-red-50 border border-red-100 rounded-md text-sm text-red-800",children:["Erro ao atualizar status: ",m.error.message]})]})]})}function Ee(){const{user:s,isLoading:o}=J();if(o)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(X,{className:"h-8 w-8 animate-spin text-primary"})});if(!s||!s.isTherapist)return e.jsx(Y,{to:"/"});const r=s.therapistId||s.id;return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Gerenciar Disponibilidade"}),e.jsxs("div",{className:"space-y-8",children:[e.jsx(me,{therapistId:r}),e.jsxs(oe,{defaultValue:"regular",className:"w-full",children:[e.jsxs(de,{className:"mb-4",children:[e.jsx(M,{value:"regular",children:"Disponibilidade Regular"}),e.jsx(M,{value:"info",children:"Informações"})]}),e.jsx(V,{value:"regular",children:e.jsx(le,{therapistId:r})}),e.jsx(V,{value:"info",children:e.jsxs("div",{className:"space-y-4 bg-card p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Como funciona a disponibilidade"}),e.jsx("p",{children:"Configure seus horários de disponibilidade para que pacientes possam agendar consultas apenas nos horários que você definir."}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"bg-primary text-primary-foreground rounded-full h-6 w-6 flex items-center justify-center mr-3 mt-0.5",children:"1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Disponibilidade Recorrente"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure dias e horários semanais em que você está disponível regularmente. Por exemplo: todas as segundas-feiras das 13h às 17h."})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"bg-primary text-primary-foreground rounded-full h-6 w-6 flex items-center justify-center mr-3 mt-0.5",children:"2"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Data Específica"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Defina disponibilidade para datas específicas quando sua agenda variar. Por exemplo: disponível em 25/08/2023 das 10h às 12h."})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"bg-primary text-primary-foreground rounded-full h-6 w-6 flex items-center justify-center mr-3 mt-0.5",children:"3"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Atendimentos de Urgência"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ative a disponibilidade para urgências quando puder atender pacientes imediatamente. Desative quando não estiver disponível para chamadas de emergência."})]})]})]})]})})]})]})]})}export{Ee as default};
