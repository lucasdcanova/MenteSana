import{c as V,r as n,j as e,P as F,bf as L,bw as O,i as _,C as S,f as I,aT as w,g as E,h as P,aN as B,B as v,F as G,H,bx as k}from"./index-DKFI7ZyH.js";import{T as J,a as K,b as A,c as M}from"./tabs-BarOwXjl.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=V("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);function l({audioId:r,onComplete:u,className:C="",autoRefresh:b=!0,refreshInterval:p=2e3,manualData:d=null}){const[c,x]=n.useState("pending"),[m,N]=n.useState(0),[g,h]=n.useState(null),[T,z]=n.useState(null),[t,a]=n.useState(!0),o=s=>{console.log("Processando dados de status:",s);let i="pending";s.processingStatus==="transcribing"||s.status==="transcribing"?i="transcribing":s.processingStatus==="analyzing"||s.status==="analyzing"||s.processingStatus==="categorizing"||s.status==="categorizing"||s.processingStatus==="generating-title"||s.status==="generating-title"?i="analyzing":s.processingStatus==="completed"||s.processingStatus==="complete"||s.status==="complete"||s.isComplete?i="completed":(s.processingStatus==="error"||s.status==="error")&&(i="error"),x(i),N(s.processingProgress||s.progress||0),s.id&&!g&&h(s.id),(i==="completed"||i==="error")&&(a(!1),i==="completed"&&u&&s.id&&u(s.id),i==="error"&&z(s.errorMessage||s.error||"Ocorreu um erro ao processar o áudio"))};n.useEffect(()=>{d&&o(d)},[d]),n.useEffect(()=>{if(!r||!t||!b||d)return;const s=async()=>{try{const j=await fetch(`/api/audio/processing-status/${r}`);if(!j.ok){console.warn(`Erro ao buscar status de processamento (rota principal): ${j.status}`);const D=await fetch(`/api/processing-status/${r}`);if(!D.ok){console.warn(`Erro ao buscar status de processamento (rota alternativa): ${D.status}`);return}const R=await D.json();console.log("Status de processamento (rota alternativa):",R),o(R);return}const $=await j.json();console.log("Status de processamento:",$),o($)}catch(j){console.error("Erro ao verificar status de processamento:",j)}};s();const i=setInterval(s,p);return()=>clearInterval(i)},[r,t,g,u,b,p,d]);const f=()=>{switch(c){case"pending":return"Preparando áudio...";case"transcribing":return"Transcrevendo áudio...";case"analyzing":return"Analisando conteúdo...";case"completed":return"Processamento concluído!";case"error":return T||"Erro no processamento";default:return"Processando..."}},y=()=>{switch(c){case"pending":return e.jsx(_,{className:"h-5 w-5 text-yellow-500"});case"transcribing":case"analyzing":return e.jsx(q,{className:"h-5 w-5 text-blue-500 animate-spin"});case"completed":return e.jsx(O,{className:"h-5 w-5 text-green-500"});case"error":return e.jsx(L,{className:"h-5 w-5 text-red-500"});default:return e.jsx(q,{className:"h-5 w-5 animate-spin"})}};return e.jsxs("div",{className:`space-y-2 ${C}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[y(),e.jsx("span",{className:"text-sm font-medium",children:f()})]}),e.jsx(F,{value:m,className:"h-2",indicatorClassName:c==="completed"?"bg-green-500":c==="error"?"bg-red-500":void 0}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[m,"%"]})]})}function W(){const[r,u]=n.useState(""),[C,b]=n.useState("tester"),[p,d]=n.useState([]),[c,x]=n.useState(!1),[m,N]=n.useState(null),g=()=>{const t=`test_${Date.now()}_${Math.floor(Math.random()*1e4)}`;return u(t),t},h=async()=>{if(!r){k({title:"ID de áudio necessário",description:"Por favor, informe um ID de áudio para testar",variant:"destructive"});return}d([]);const t=[`/api/audio/processing-status/${r}`,`/api/processing-status/${r}`];for(const a of t)try{const o=await fetch(a),f=o.status;let y=null;try{y=await o.json()}catch{}d(s=>[...s,{url:a,status:f,data:y}])}catch(o){d(f=>[...f,{url:a,status:0,data:{error:o instanceof Error?o.message:String(o)}}])}},T=async()=>{const t=r||g();try{const o=await(await fetch(`/api/create-test-processing/${t}`)).json();k({title:"Processamento iniciado",description:`ID: ${t}. Status: ${o.status}, Progresso: ${o.progress}%`}),h()}catch(a){k({title:"Erro ao iniciar processamento",description:a instanceof Error?a.message:String(a),variant:"destructive"})}},z=()=>{if(c)x(!1);else{if(!r){k({title:"ID de áudio necessário",description:"Por favor, informe um ID de áudio para iniciar o polling",variant:"destructive"});return}x(!0)}};return n.useEffect(()=>{let t;return c&&r&&(t=setInterval(async()=>{try{const o=await(await fetch(`/api/audio/processing-status/${r}`)).json();N(o),(o.status==="complete"||o.status==="error")&&x(!1)}catch(a){console.error("Erro no polling:",a),N({error:a instanceof Error?a.message:String(a)})}},1e3)),()=>{t&&clearInterval(t)}},[c,r]),e.jsxs("div",{className:"container py-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Teste de Status de Processamento de Áudio"}),e.jsx("p",{className:"text-muted-foreground",children:"Esta página permite testar o componente AudioProcessingStatus e seus endpoints relacionados."})]}),e.jsxs(S,{children:[e.jsxs(I,{children:[e.jsx(w,{children:"Identificador de Áudio"}),e.jsx(E,{children:"Informe ou gere um ID para testar o status de processamento"})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(B,{value:r,onChange:t=>u(t.target.value),placeholder:"ID do áudio (ex: audio_123456789)",className:"flex-1"}),e.jsx(v,{onClick:g,children:"Gerar ID de Teste"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{onClick:h,variant:"outline",className:"flex-1",children:"Testar Endpoints de Status"}),e.jsx(v,{onClick:T,className:"flex-1",children:"Iniciar Processamento de Teste"})]})]})]}),e.jsxs(J,{value:C,onValueChange:b,children:[e.jsxs(K,{className:"grid grid-cols-2",children:[e.jsx(A,{value:"tester",children:"Testador de Componente"}),e.jsx(A,{value:"endpoints",children:"Resultados de Endpoints"})]}),e.jsxs(M,{value:"tester",className:"space-y-4",children:[e.jsxs(S,{children:[e.jsxs(I,{children:[e.jsx(w,{children:"Teste do Componente AudioProcessingStatus"}),e.jsx(E,{children:"Visualize o componente em ação com polling automático"})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Status para: ",e.jsx("code",{className:"bg-muted rounded p-1",children:r||"Nenhum ID informado"})]}),e.jsx(v,{onClick:z,variant:c?"destructive":"outline",size:"sm",children:c?"Parar Polling":"Iniciar Polling"})]}),e.jsx("div",{className:"border rounded-md p-4",children:r?e.jsx(l,{audioId:r,autoRefresh:!1,manualData:m}):e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Informe um ID de áudio para visualizar o status"})}),m&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Dados do polling:"}),e.jsx("pre",{className:"bg-muted p-2 rounded-md text-xs overflow-auto",children:JSON.stringify(m,null,2)})]})]})]}),e.jsxs(S,{children:[e.jsxs(I,{children:[e.jsx(w,{children:"Componente com Status Fixos"}),e.jsx(E,{children:"Visualize o componente com valores estáticos para cada estado"})]}),e.jsxs(P,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border rounded-md p-4",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Em Fila (0%)"}),e.jsx(l,{audioId:"static-queued",autoRefresh:!1,manualData:{status:"queued",progress:0,audioId:"static-queued"}})]}),e.jsxs("div",{className:"border rounded-md p-4",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Transcrevendo (30%)"}),e.jsx(l,{audioId:"static-transcribing",autoRefresh:!1,manualData:{status:"transcribing",progress:30,audioId:"static-transcribing"}})]}),e.jsxs("div",{className:"border rounded-md p-4",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Analisando (60%)"}),e.jsx(l,{audioId:"static-analyzing",autoRefresh:!1,manualData:{status:"analyzing",progress:60,audioId:"static-analyzing"}})]}),e.jsxs("div",{className:"border rounded-md p-4",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Gerando Título (80%)"}),e.jsx(l,{audioId:"static-title",autoRefresh:!1,manualData:{status:"generating-title",progress:80,audioId:"static-title"}})]}),e.jsxs("div",{className:"border rounded-md p-4",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Completo (100%)"}),e.jsx(l,{audioId:"static-complete",autoRefresh:!1,manualData:{status:"complete",progress:100,audioId:"static-complete"}})]}),e.jsxs("div",{className:"border rounded-md p-4",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Erro (10%)"}),e.jsx(l,{audioId:"static-error",autoRefresh:!1,manualData:{status:"error",progress:10,audioId:"static-error",error:"Erro de exemplo para visualização"}})]})]})]})]}),e.jsx(M,{value:"endpoints",children:e.jsxs(S,{children:[e.jsxs(I,{children:[e.jsx(w,{children:"Resultados dos Endpoints"}),e.jsx(E,{children:"Visualize as respostas de diferentes endpoints de status"})]}),e.jsx(P,{children:p.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:'Clique em "Testar Endpoints de Status" para ver os resultados'}):e.jsx("div",{className:"space-y-4",children:p.map((t,a)=>e.jsxs("div",{className:"border rounded-md p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-mono text-sm",children:t.url}),e.jsx("span",{className:`text-sm px-2 py-1 rounded ${t.status>=200&&t.status<300?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:t.status||"Erro"})]}),e.jsx(G,{className:"my-2"}),e.jsx("pre",{className:"bg-muted p-2 rounded-md text-xs overflow-auto mt-2",children:JSON.stringify(t.data,null,2)})]},a))})}),e.jsx(H,{children:e.jsx(v,{onClick:h,variant:"outline",className:"w-full",children:"Verificar Endpoints Novamente"})})]})})]})]})}export{W as default};
