import{b3 as x,b as R,u as W,r as C,aR as re,aS as te,z as ie,I as oe,j as e,aU as le,aV as h,aW as j,aX as g,aY as f,aN as _,aZ as F,b1 as y,bJ as me,B as m,d as ne,y as z,C as G,f as Q,h as V,H as K,b2 as L,aT as ce,g as de,bP as xe,J as N}from"./index-DKFI7ZyH.js";import{B as O}from"./badge-CsDoxorc.js";import{A as pe,a as ue,b as he}from"./alert-BjzQykUU.js";import{S as p}from"./skeleton-CDe7BuYf.js";import{D as je,a as ge,e as fe,b as Ne,f as ve,c as be,g as we}from"./dialog-B2iG5lPB.js";import{T as M}from"./textarea-CW1zArsP.js";import{S as B,a as I,b as $,c as U,d as H}from"./select-DV2zMmnw.js";import{S as ye}from"./switch-Cz62NSvB.js";import{P as J}from"./plus-BTDcvFex.js";import{S as k}from"./search-D9RKuYgR.js";import{U as Ce}from"./user-plus-DziNTdJR.js";import{f as Se}from"./formatDistanceToNow-CnNYJNjZ.js";import{p as Te}from"./pt-BnVU24TM.js";import"./chevron-down-VAhjCEtL.js";import"./endOfMonth-D7azNT7e.js";const De=x.object({name:x.string().min(3,{message:"O nome deve ter pelo menos 3 caracteres"}).max(100),description:x.string().min(10,{message:"A descrição deve ter pelo menos 10 caracteres"}).max(2e3),topic:x.string({required_error:"Escolha um tópico"}),isPrivate:x.boolean().default(!1),rules:x.string().optional(),meetingFrequency:x.string().optional(),therapistId:x.number().optional().nullable(),withTherapistSupport:x.boolean().default(!1)}),Fe=({open:v,onOpenChange:n,topics:S=[],onSuccess:c})=>{const{toast:u}=R(),{user:i}=W();C.useEffect(()=>{v&&i&&!i.isTherapist&&(u({title:"Acesso restrito",description:"Apenas terapeutas podem criar grupos de apoio.",variant:"destructive"}),n(!1))},[v,i,u,n]);const o=re({resolver:te(De),defaultValues:{name:"",description:"",topic:"",isPrivate:!1,rules:"",meetingFrequency:"",therapistId:null,withTherapistSupport:!1}}),T=ie({mutationFn:async a=>{const t=await oe("POST","/api/support-groups",a);if(!t.ok){const P=await t.json();throw new Error(P.message||"Erro ao criar grupo")}return await t.json()},onSuccess:()=>{u({title:"Grupo criado com sucesso!",description:"O grupo foi criado e está disponível para participação."}),o.reset(),n(!1),c&&c()},onError:a=>{u({title:"Erro ao criar grupo",description:a instanceof Error?a.message:"Ocorreu um erro ao criar o grupo",variant:"destructive"})}}),D=a=>{if(!(i!=null&&i.isTherapist)){u({title:"Acesso restrito",description:"Apenas terapeutas podem criar grupos de apoio.",variant:"destructive"}),n(!1);return}const t={...a,therapistId:i.id};console.log("Enviando dados para criação de grupo:",t),T.mutate(t)},r=[{value:"semanal",label:"Semanal"},{value:"quinzenal",label:"Quinzenal"},{value:"mensal",label:"Mensal"},{value:"sob-demanda",label:"Sob demanda"}];return e.jsx(je,{open:v,onOpenChange:n,children:e.jsxs(ge,{className:"sm:max-w-[600px] w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(fe,{className:"sm:px-2",children:[e.jsx(Ne,{className:"text-xl sm:text-2xl",children:"Criar um novo grupo de apoio"}),e.jsx(ve,{className:"text-sm sm:text-base",children:"Crie um espaço seguro para compartilhar experiências e receber apoio da comunidade"})]}),e.jsx(le,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(D),className:"space-y-4 sm:space-y-5 px-1 sm:px-2",children:[e.jsx(h,{control:o.control,name:"name",render:({field:a})=>e.jsxs(j,{children:[e.jsx(g,{className:"text-sm font-medium",children:"Nome do grupo"}),e.jsx(f,{children:e.jsx(_,{placeholder:"Ex: Ansiedade e Depressão",...a,className:"text-sm sm:text-base"})}),e.jsx(F,{className:"text-xs sm:text-sm"})]})}),e.jsx(h,{control:o.control,name:"topic",render:({field:a})=>e.jsxs(j,{children:[e.jsx(g,{className:"text-sm font-medium",children:"Tópico principal"}),e.jsxs(B,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(f,{children:e.jsx(I,{className:"text-sm sm:text-base",children:e.jsx($,{placeholder:"Selecione um tópico"})})}),e.jsx(U,{className:"max-h-[40vh]",children:S.map(t=>e.jsx(H,{value:t.id,className:"text-sm sm:text-base",children:t.name},t.id))})]}),e.jsx(y,{className:"text-xs sm:text-sm",children:"Selecione o tema principal do grupo"}),e.jsx(F,{className:"text-xs sm:text-sm"})]})}),e.jsx(h,{control:o.control,name:"description",render:({field:a})=>e.jsxs(j,{children:[e.jsx(g,{className:"text-sm font-medium",children:"Descrição"}),e.jsx(f,{children:e.jsx(M,{placeholder:"Descreva o propósito do grupo e quem pode se beneficiar dele...",className:"min-h-[80px] sm:min-h-[100px] text-sm sm:text-base resize-y",...a})}),e.jsx(y,{className:"text-xs sm:text-sm",children:"Explique o objetivo do grupo e quais tipos de experiências serão compartilhadas"}),e.jsx(F,{className:"text-xs sm:text-sm"})]})}),e.jsx(h,{control:o.control,name:"rules",render:({field:a})=>e.jsxs(j,{children:[e.jsx(g,{className:"text-sm font-medium",children:"Regras do grupo (opcional)"}),e.jsx(f,{children:e.jsx(M,{placeholder:"Ex: 1. Respeite a privacidade dos participantes. 2. Evite críticas...",className:"min-h-[60px] sm:min-h-[80px] text-sm sm:text-base resize-y",...a})}),e.jsx(y,{className:"text-xs sm:text-sm",children:"Defina diretrizes para manter o grupo saudável e seguro"}),e.jsx(F,{className:"text-xs sm:text-sm"})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(h,{control:o.control,name:"meetingFrequency",render:({field:a})=>e.jsxs(j,{children:[e.jsx(g,{className:"text-sm font-medium",children:"Frequência (opcional)"}),e.jsxs(B,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(f,{children:e.jsx(I,{className:"text-sm sm:text-base",children:e.jsx($,{placeholder:"Selecione uma frequência"})})}),e.jsx(U,{children:r.map(t=>e.jsx(H,{value:t.value,className:"text-sm sm:text-base",children:t.label},t.value))})]}),e.jsx(y,{className:"text-xs sm:text-sm",children:"Regularidade das reuniões"}),e.jsx(F,{className:"text-xs sm:text-sm"})]})}),e.jsx(h,{control:o.control,name:"isPrivate",render:({field:a})=>e.jsxs(j,{className:"flex flex-row items-center justify-between rounded-lg border p-3 sm:p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-sm sm:text-base",children:"Grupo privado"}),e.jsx(y,{className:"text-xs sm:text-sm",children:"Membros precisam de aprovação"})]}),e.jsx(f,{children:e.jsx(ye,{checked:a.value,onCheckedChange:a.onChange})})]})})]}),e.jsx(h,{control:o.control,name:"withTherapistSupport",render:({field:a})=>e.jsxs(j,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-3 sm:p-4",children:[e.jsx(f,{children:e.jsx(me,{checked:a.value,onCheckedChange:a.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(g,{className:"text-sm sm:text-base",children:"Solicitar suporte profissional"}),e.jsx(y,{className:"text-xs sm:text-sm",children:"Terapeuta designado para moderar o grupo"})]})]})}),e.jsxs(be,{className:"sm:px-2 pt-2 flex flex-col sm:flex-row gap-2 sm:gap-2",children:[e.jsx(we,{asChild:!0,children:e.jsx(m,{type:"button",variant:"outline",className:"w-full sm:w-auto text-sm",children:"Cancelar"})}),e.jsx(m,{type:"submit",disabled:T.isPending,className:"w-full sm:w-auto text-sm",children:T.isPending?"Criando...":"Criar grupo"})]})]})})]})})},$e=()=>{const[,v]=ne(),{user:n}=W(),{toast:S}=R(),[c,u]=C.useState(""),[i,o]=C.useState(null),[T,D]=C.useState(!1),[r,a]=C.useState(!1),{data:t=[],isLoading:P}=z({queryKey:["/api/support-groups/topics"],staleTime:3e5,refetchOnWindowFocus:!1}),{data:b,isLoading:X,error:Y,refetch:Z}=z({queryKey:["/api/support-groups",{search:c||void 0,topic:i||void 0}],staleTime:6e4,refetchOnWindowFocus:!1}),q=(b==null?void 0:b.data)||[],d=(b==null?void 0:b.pagination)||null,ee=s=>{s.preventDefault(),Z()},E=()=>{u(""),o(null),N.invalidateQueries({queryKey:["/api/support-groups"]})},A=s=>{r||(a(!0),N.prefetchQuery({queryKey:["/api/support-groups",s],staleTime:6e4}),setTimeout(()=>{v(`/support-groups/${s}`),setTimeout(()=>a(!1),500)},100))},se=async(s,l)=>{if(l.preventDefault(),l.stopPropagation(),!r){if(!n){S({title:"Faça login para participar",description:"Você precisa estar logado para participar de um grupo de apoio.",variant:"destructive"});return}try{a(!0);const w=await fetch(`/api/support-groups/${s}/join`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!w.ok){const ae=await w.json();throw new Error(ae.message||"Não foi possível entrar no grupo")}S({title:"Você entrou no grupo!",description:"Agora você pode participar das discussões e reuniões."}),await N.invalidateQueries({queryKey:["/api/support-groups"]}),await N.prefetchQuery({queryKey:["/api/support-groups",s],staleTime:6e4}),setTimeout(()=>{v(`/support-groups/${s}`),setTimeout(()=>a(!1),500)},300)}catch(w){console.error("Erro ao entrar no grupo:",w),S({title:"Erro ao entrar no grupo",description:w instanceof Error?w.message:"Ocorreu um erro inesperado",variant:"destructive"}),a(!1)}}};return C.useEffect(()=>{const s=setTimeout(()=>{r&&a(!1)},3e3);return()=>clearTimeout(s)},[r]),e.jsxs("div",{className:"container max-w-5xl mx-auto px-3 sm:px-4 py-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 sm:mb-6",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold",children:"Grupos de Apoio"}),(n==null?void 0:n.isTherapist)&&e.jsxs(m,{onClick:()=>D(!0),size:"sm",className:"text-xs sm:text-sm",disabled:r,children:[e.jsx(J,{className:"mr-1 sm:mr-2 h-3 w-3 sm:h-4 sm:w-4"}),"Criar Grupo"]})]}),e.jsx("div",{className:"bg-card rounded-lg p-3 sm:p-4 mb-4 sm:mb-6 border",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:gap-4",children:[e.jsxs("form",{onSubmit:ee,className:"flex gap-2",children:[e.jsx(_,{placeholder:"Buscar grupos...",value:c,onChange:s=>u(s.target.value),className:"flex-1 text-sm h-9",disabled:r}),e.jsxs(m,{type:"submit",variant:"secondary",size:"sm",className:"text-xs sm:text-sm whitespace-nowrap",disabled:r,children:[e.jsx(k,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Buscar"})]}),(c||i)&&e.jsx(m,{type:"button",variant:"ghost",size:"sm",onClick:E,className:"text-xs sm:text-sm",disabled:r,children:"Limpar"})]}),P?e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-thin",children:Array(5).fill(0).map((s,l)=>e.jsx(p,{className:"h-7 sm:h-8 w-20 sm:w-24 rounded-full flex-shrink-0"},l))}):e.jsx("div",{className:"flex gap-1 sm:gap-2 overflow-x-auto pb-2 scrollbar-thin",children:t.map(s=>e.jsx(O,{variant:i===s.id?"default":"outline",className:`cursor-pointer text-xs sm:text-sm py-1 px-2 sm:px-3 flex-shrink-0 ${r?"opacity-50 pointer-events-none":""}`,onClick:()=>!r&&o(i===s.id?null:s.id),children:s.name},s.id))})]})}),Y?e.jsxs(pe,{variant:"destructive",className:"mb-4 sm:mb-6 text-sm",children:[e.jsx(ue,{className:"text-base",children:"Erro ao carregar grupos"}),e.jsx(he,{className:"text-sm",children:"Não foi possível carregar os grupos de apoio. Por favor, tente novamente mais tarde."})]}):X?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:Array(4).fill(0).map((s,l)=>e.jsxs(G,{className:"overflow-hidden",children:[e.jsxs(Q,{className:"p-3 sm:p-4 pb-1 sm:pb-2",children:[e.jsx(p,{className:"h-5 sm:h-6 w-3/4 mb-2"}),e.jsx(p,{className:"h-3 sm:h-4 w-full"})]}),e.jsxs(V,{className:"p-3 sm:p-4 pb-2 sm:pb-3",children:[e.jsxs("div",{className:"space-y-1 sm:space-y-2",children:[e.jsx(p,{className:"h-3 sm:h-4 w-full"}),e.jsx(p,{className:"h-3 sm:h-4 w-full"}),e.jsx(p,{className:"h-3 sm:h-4 w-2/3"})]}),e.jsxs("div",{className:"flex gap-2 mt-3 sm:mt-4",children:[e.jsx(p,{className:"h-5 sm:h-6 w-16 sm:w-20 rounded-full"}),e.jsx(p,{className:"h-5 sm:h-6 w-16 sm:w-20 rounded-full"})]})]}),e.jsx(K,{className:"p-3 sm:p-4 pt-0 sm:pt-0",children:e.jsx(p,{className:"h-8 sm:h-9 w-full"})})]},l))}):q.length===0?e.jsx("div",{className:"text-center py-6 sm:py-10 bg-white rounded-xl shadow-sm border border-gray-100 max-w-xl mx-auto",children:c||i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-flex items-center justify-center w-14 h-14 rounded-full bg-orange-50 text-orange-500 mb-4",children:e.jsx(k,{className:"h-7 w-7"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhum grupo encontrado"}),e.jsx("p",{className:"text-muted-foreground mb-4 max-w-md mx-auto",children:"Nenhum grupo corresponde aos filtros aplicados. Tente ajustar sua busca ou explorar outros tópicos."}),e.jsxs(m,{onClick:E,variant:"outline",className:"mx-auto",disabled:r,children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Limpar filtros"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-flex items-center justify-center w-14 h-14 rounded-full bg-primary/10 text-primary mb-4",children:e.jsx(L,{className:"h-7 w-7"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhum grupo disponível"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"No momento não existem grupos de apoio disponíveis. Que tal criar o primeiro grupo e iniciar uma comunidade?"}),e.jsxs("div",{className:"space-y-3 max-w-xs mx-auto mb-6",children:[e.jsx("p",{className:"text-sm text-left text-muted-foreground",children:"Grupos de apoio permitem:"}),e.jsxs("ul",{className:"text-sm text-left space-y-2",children:[e.jsxs("li",{className:"flex items-start",children:[e.jsx("div",{className:"mr-2 mt-0.5 text-primary",children:"✓"}),e.jsx("div",{children:"Compartilhar experiências em um ambiente seguro"})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("div",{className:"mr-2 mt-0.5 text-primary",children:"✓"}),e.jsx("div",{children:"Obter suporte de pessoas com vivências semelhantes"})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("div",{className:"mr-2 mt-0.5 text-primary",children:"✓"}),e.jsx("div",{children:"Participar de discussões e sessões coletivas"})]})]})]}),e.jsxs(m,{onClick:()=>D(!0),size:"lg",disabled:r,className:"gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),"Criar um grupo"]})]})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:q.map(s=>e.jsxs(G,{className:`overflow-hidden transition-opacity ${r?"opacity-50 pointer-events-none":"hover:border-primary/50 cursor-pointer"}`,onClick:()=>A(s.id),children:[e.jsxs(Q,{className:"p-3 sm:p-4 pb-1 sm:pb-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(ce,{className:"text-base sm:text-lg",children:s.name}),e.jsx(O,{variant:"outline",className:"ml-2 text-xs sm:text-sm",children:s.topic})]}),e.jsxs(de,{className:"text-xs sm:text-sm",children:[s.isPrivate&&"Grupo privado • ","Criado ",Se(new Date(s.createdAt),{locale:Te,addSuffix:!0})]})]}),e.jsxs(V,{className:"p-3 sm:p-4 py-2 sm:py-3",children:[e.jsx("p",{className:"text-xs sm:text-sm line-clamp-2 mb-2 sm:mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 text-xs sm:text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),e.jsxs("span",{children:[s.memberCount||0," ",s.memberCount===1?"membro":"membros"]})]}),s.therapist&&e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"text-xs",children:"Moderado por profissional"})})]})]}),e.jsxs(K,{className:"p-3 sm:p-4 pt-0 sm:pt-0 flex gap-2",children:[e.jsxs(m,{onClick:l=>se(s.id,l),variant:"outline",size:"sm",className:"flex-1 text-xs sm:text-sm h-8 sm:h-9",disabled:r,children:[e.jsx(Ce,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),"Participar"]}),e.jsxs(m,{variant:"default",size:"sm",className:"flex-1 text-xs sm:text-sm h-8 sm:h-9",disabled:r,onClick:l=>{l.preventDefault(),l.stopPropagation(),A(s.id)},children:[e.jsx(xe,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),"Ver grupo"]})]})]},s.id))}),d&&d.totalPages>1&&e.jsx("div",{className:"flex justify-center mt-4 sm:mt-6",children:e.jsxs("div",{className:"flex gap-1 sm:gap-2",children:[e.jsx(m,{variant:"outline",size:"sm",className:"h-8 text-xs sm:text-sm px-2 sm:px-3",disabled:d.page===1||r,onClick:()=>{r||N.prefetchQuery({queryKey:["/api/support-groups",{search:c||void 0,topic:i||void 0,page:d.page-1}]})},children:"Anterior"}),e.jsxs("div",{className:"flex items-center px-2 sm:px-3 text-xs sm:text-sm",children:["Página ",d.page," de ",d.totalPages]}),e.jsx(m,{variant:"outline",size:"sm",className:"h-8 text-xs sm:text-sm px-2 sm:px-3",disabled:d.page===d.totalPages||r,onClick:()=>{r||N.prefetchQuery({queryKey:["/api/support-groups",{search:c||void 0,topic:i||void 0,page:d.page+1}]})},children:"Próxima"})]})}),e.jsx(Fe,{open:T,onOpenChange:s=>!r&&D(s),topics:t||[],onSuccess:()=>{N.invalidateQueries({queryKey:["/api/support-groups"]})}})]})};export{$e as default};
