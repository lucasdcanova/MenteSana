import{c as Y,u as Z,b as q,d as ee,b4 as se,r as d,bo as $,y as P,A as o,z as R,j as e,E as A,L as v,i as F,B as u,bB as ae,J as w,b7 as te,b5 as re,I as B}from"./index-DKFI7ZyH.js";import{T as ne}from"./textarea-CW1zArsP.js";import{D as le,a as ie,e as ce,b as de,c as oe}from"./dialog-B2iG5lPB.js";import{R as me}from"./refresh-cw-RqVKnbVz.js";import{C as xe}from"./chevron-right-Bo6uQhrt.js";import{p as j}from"./pt-BnVU24TM.js";import{i as C}from"./isSameDay-BgnmRS2q.js";import{a as E}from"./addDays--7OLxFs-.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=Y("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),ue=()=>{const a=q();return R({mutationFn:async t=>{const n=await B("DELETE",`/api/sessions/${t}`);if(!n.ok)throw new Error("Falha ao cancelar consulta");return n.json()},onSuccess:(t,n)=>{const r=["/api/sessions"];w.setQueryData(r,i=>i&&{...i,data:i.data.map(p=>p.id===n?{...p,status:"Cancelada"}:p)}),w.invalidateQueries({queryKey:["/api/sessions"]}),a.toast({title:"Consulta cancelada",description:"A consulta foi cancelada com sucesso.",variant:"default"})},onError:t=>{console.error("Appointment cancellation error:",t),a.toast({title:"Erro",description:"Não foi possível cancelar a consulta. Tente novamente.",variant:"destructive"})}})},pe=({sessionId:a})=>{const t=ue(),n=r=>{r.preventDefault(),window.confirm("Tem certeza que deseja cancelar esta consulta?")&&t.mutate(a)};return e.jsx(u,{size:"sm",variant:"outline",className:"text-xs px-3 h-8 border-red-300 text-red-600 hover:bg-red-50",onClick:n,disabled:t.isPending,children:t.isPending?"Cancelando...":"Cancelar"})},je=({time:a,isAvailable:t,isSelected:n,onSelect:r})=>e.jsx("button",{onClick:r,disabled:!t,className:`
        w-full rounded-md text-center py-2 px-1 text-sm transition-colors
        ${n?"bg-primary text-white":t?"bg-white hover:bg-primary/10 border border-gray-200":"bg-gray-100 text-gray-400 cursor-not-allowed border border-gray-200"}
      `,children:a}),ge=({therapist:a,selected:t,onSelect:n})=>{var r;return e.jsxs("div",{className:`
        p-4 rounded-xl border bg-white cursor-pointer transition-all
        ${t?"border-primary shadow-sm":"border-gray-200 hover:border-gray-300"}
      `,onClick:n,children:[e.jsxs("div",{className:"flex items-center",children:[a.imageUrl?e.jsx("img",{src:a.imageUrl,alt:`${a.firstName} ${a.lastName}`,className:"w-12 h-12 rounded-full object-cover mr-3"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary bg-opacity-20 flex items-center justify-center mr-3",children:e.jsxs("span",{className:"text-primary-dark font-semibold",children:[a.firstName.charAt(0),a.lastName.charAt(0)]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Dr. ",a.firstName," ",a.lastName]}),e.jsx("p",{className:"text-sm text-gray-600",children:a.specialization||"Terapia Geral"})]}),e.jsx("div",{className:"flex-shrink-0",children:a.rating?e.jsxs("div",{className:"flex items-center bg-green-50 rounded-full px-2 py-1",children:[e.jsx("span",{className:"text-green-600 text-sm font-semibold",children:a.rating.toFixed(1)}),e.jsx("span",{className:"text-yellow-500 ml-1",children:"★"})]}):null})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:(r=a.tags)==null?void 0:r.slice(0,3).map(i=>e.jsx("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-full",children:i},i))}),e.jsx("p",{className:"text-sm text-gray-500 line-clamp-2",children:a.bio||"Profissional especializado em saúde mental, oferecendo suporte terapêutico personalizado."})]})]})},fe=({date:a,isSelected:t,onSelect:n})=>{const r=C(a,new Date),i=o(a,"EEE",{locale:j}).slice(0,3),g=o(a,"d");return e.jsxs("button",{onClick:n,className:`
        flex flex-col items-center p-2 rounded-lg transition-colors
        ${t?"bg-primary text-white":r?"bg-primary/10 text-primary font-semibold":"hover:bg-gray-100"}
      `,children:[e.jsx("span",{className:"text-xs font-medium",children:i}),e.jsx("span",{className:`text-lg ${t?"font-bold":""}`,children:g})]})},z=({currentDate:a,onDateChange:t})=>{const n=Array.from({length:7},(r,i)=>E($(a),i));return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("button",{onClick:()=>t(E(a,-7)),className:"p-2 rounded-full hover:bg-gray-100",children:e.jsx(re,{className:"h-5 w-5"})}),e.jsx("h3",{className:"text-lg font-medium",children:o(a,"MMMM yyyy",{locale:j})}),e.jsx("button",{onClick:()=>t(E(a,7)),className:"p-2 rounded-full hover:bg-gray-100",children:e.jsx(xe,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:n.map((r,i)=>e.jsx(fe,{date:r,isSelected:C(r,a),onSelect:()=>t(r)},i))})]})},be=({session:a})=>{const t=new Date(a.scheduledFor),n=t<new Date;return e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100 mb-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(F,{className:"h-4 w-4 text-primary mr-2"}),e.jsx("p",{className:"font-medium",children:o(t,"HH:mm")})]}),e.jsxs("h3",{className:"text-lg font-semibold mt-1",children:["Paciente #",a.userId||"Anônimo"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a.notes||"Sem anotações"})]}),e.jsx("div",{children:n?e.jsx("span",{className:"text-gray-400 text-xs py-1 px-2 bg-gray-100 rounded-full",children:"Concluída"}):e.jsx(v,{href:`/video-call/${a.id}`,children:e.jsx(u,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-xs px-3 h-8",children:"Atender"})})})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:e.jsx("p",{className:"text-xs text-gray-500",children:o(t,"dd 'de' MMMM 'de' yyyy",{locale:j})})})]})};function ke(){const{user:a}=Z(),{toast:t}=q(),[,n]=ee(),r=se(),i=r!=null&&r.therapistId?parseInt(r.therapistId):void 0,g=typeof window<"u"?sessionStorage.getItem("viewingAsTherapist")==="true":!1,p=(a==null?void 0:a.isTherapist)||g||!1;d.useEffect(()=>{g&&sessionStorage.removeItem("viewingAsTherapist")},[g]);const D=d.useRef(null),T=d.useRef(null),[x,I]=d.useState($(new Date)),[h,S]=d.useState(null),[c,K]=d.useState(i||null),[O,y]=d.useState(!1),[H,Q]=d.useState(""),{data:f,isLoading:V}=P({queryKey:["/api/therapists"]}),{data:k,isLoading:U}=P({queryKey:["/api/sessions"]}),M=(k==null?void 0:k.data)||[],b=M.filter(s=>{const l=new Date(s.scheduledFor);return C(l,x)&&(p?s.therapistId===(a==null?void 0:a.id):!0)}).sort((s,l)=>new Date(s.scheduledFor).getTime()-new Date(l.scheduledFor).getTime()),L=M.filter(s=>{const l=new Date(s.scheduledFor);return!p&&l>=new Date&&s.status!=="Cancelada"&&s.status.toLowerCase()!=="canceled"&&!s.status.includes("cancel")}).sort((s,l)=>new Date(s.scheduledFor).getTime()-new Date(l.scheduledFor).getTime()).slice(0,3),_=M.filter(s=>{const l=new Date(s.scheduledFor);return C(l,x)&&(c?s.therapistId===c:!0)}).map(s=>o(new Date(s.scheduledFor),"HH:mm")),X=Array.from({length:10},(s,l)=>`${(l+9).toString().padStart(2,"0")}:00`),G=R({mutationFn:async s=>(await B("POST","/api/sessions",s)).json(),onSuccess:s=>{w.invalidateQueries({queryKey:["/api/sessions"]}),t({title:"Consulta agendada",description:"Sua consulta foi agendada com sucesso.",variant:"default"}),n("/")},onError:s=>{t({title:"Erro",description:"Não foi possível agendar a consulta. Tente novamente.",variant:"destructive"}),console.error("Appointment booking error:",s)}}),J=()=>{if(!c||!h)return;const[s,l]=h.split(":").map(Number),N=new Date(x);N.setHours(s,l,0,0),G.mutate({therapistId:c,scheduledFor:N,notes:H}),y(!1)},m=f==null?void 0:f.find(s=>s.id===c);return d.useEffect(()=>{c&&D.current&&setTimeout(()=>{var s;(s=D.current)==null||s.scrollIntoView({behavior:"smooth",block:"start"})},200)},[c]),d.useEffect(()=>{h&&T.current&&setTimeout(()=>{var s;(s=T.current)==null||s.scrollIntoView({behavior:"smooth",block:"start"})},200)},[h]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 max-w-md mx-auto ios-scroll-fix",children:p?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm border border-gray-100 mb-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(A,{className:"h-5 w-5 text-primary mr-2"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Consultas Agendadas"})]}),e.jsx(z,{currentDate:x,onDateChange:I})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm border border-gray-100 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:o(x,"dd 'de' MMMM",{locale:j})}),e.jsxs("span",{className:"text-sm text-gray-500",children:[(b==null?void 0:b.length)||0," consultas"]})]}),U?e.jsx("div",{className:"text-center py-8",children:"Carregando agenda..."}):b&&b.length>0?e.jsx("div",{className:"space-y-3",children:b.map(s=>e.jsx(be,{session:s},s.id))}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Nenhuma consulta agendada para esta data."})]})]}):e.jsxs("div",{className:"space-y-6",children:[L.length>0&&e.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm border border-primary/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"h-5 w-5 text-primary mr-2"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Suas Consultas"})]}),e.jsx(v,{href:"/profile",children:e.jsx("span",{className:"text-primary text-sm hover:underline",children:"Ver todas"})})]}),e.jsx("div",{className:"space-y-3",children:L.map(s=>{const l=new Date(s.scheduledFor),N=l<new Date,W=s.therapistName||"Terapeuta";return e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-100",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-lg",children:W}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(F,{className:"h-4 w-4 text-primary mr-1"}),e.jsx("p",{className:"text-sm text-gray-700",children:o(l,"dd 'de' MMMM 'às' HH:mm",{locale:j})})]})]}),e.jsx("div",{className:"flex space-x-2",children:N?e.jsx("span",{className:"text-gray-400 text-xs py-1 px-2 bg-gray-100 rounded-full",children:"Concluída"}):e.jsxs(e.Fragment,{children:[e.jsx(v,{href:`/video-call/${s.id}`,children:e.jsx(u,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-xs px-3 h-8",children:"Entrar"})}),e.jsx(pe,{sessionId:s.id})]})})]})},s.id)})})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-5 shadow-sm mb-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"bg-red-500 rounded-full p-2 mr-3",children:e.jsx(ae,{className:"h-5 w-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold text-red-700",children:"Atendimento de Emergência"})]}),e.jsx("p",{className:"text-red-700 mb-4",children:"Precisa de ajuda imediata? Temos terapeutas disponíveis para atendimento de emergência."}),e.jsx(v,{href:"/emergency",children:e.jsx(u,{className:"w-full bg-red-600 hover:bg-red-700",children:"Ver Terapeutas Disponíveis Agora"})})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-center mb-4",children:e.jsx("h2",{className:"text-xl font-semibold",children:"Escolha um Terapeuta"})}),V?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),e.jsx("p",{children:"Carregando terapeutas..."})]}):f&&f.length>0?e.jsx("div",{className:"space-y-4",children:f.map(s=>e.jsx(ge,{therapist:s,selected:c===s.id,onSelect:()=>{K(s.id),S(null)}},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-orange-50 text-orange-500 mb-4",children:e.jsx(he,{className:"h-8 w-8"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Sem terapeutas disponíveis"}),e.jsx("p",{className:"text-gray-500 max-w-sm mx-auto mb-4",children:"No momento não há terapeutas disponíveis para agendamento. Tente novamente mais tarde ou entre em contato com nosso suporte."}),e.jsxs(u,{variant:"outline",onClick:()=>w.invalidateQueries({queryKey:["/api/therapists"]}),className:"mt-2",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Atualizar lista"]})]})]}),c&&e.jsxs("div",{ref:D,className:"bg-white rounded-xl p-5 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(A,{className:"h-5 w-5 text-primary mr-2"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Escolha uma Data"})]}),e.jsx(z,{currentDate:x,onDateChange:s=>{I(s),S(null)}}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(F,{className:"h-5 w-5 text-primary mr-2"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Escolha um Horário"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:X.map(s=>e.jsx(je,{time:s,isAvailable:!_.includes(s),isSelected:h===s,onSelect:()=>S(s)},s))})]})]}),c&&h&&m&&e.jsxs("div",{ref:T,className:"bg-white rounded-xl p-5 shadow-sm border border-gray-100",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Resumo da Consulta"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Terapeuta"}),e.jsxs("p",{className:"font-medium",children:["Dr. ",m.firstName," ",m.lastName]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Data e Horário"}),e.jsxs("p",{className:"font-medium",children:[o(x,"dd 'de' MMMM 'de' yyyy",{locale:j})," às ",h]})]}),e.jsx(u,{className:"w-full",onClick:()=>y(!0),children:"Confirmar Agendamento"})]})]})}),e.jsx(le,{open:O,onOpenChange:y,children:e.jsxs(ie,{className:"sm:max-w-md",children:[e.jsx(ce,{children:e.jsx(de,{children:"Confirmar Agendamento"})}),e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Terapeuta"}),e.jsxs("p",{className:"font-medium",children:["Dr. ",m==null?void 0:m.firstName," ",m==null?void 0:m.lastName]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Data e Horário"}),e.jsxs("p",{className:"font-medium",children:[o(x,"dd 'de' MMMM 'de' yyyy",{locale:j})," às"," ",h]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(te,{htmlFor:"notes",children:"Observações (opcional)"}),e.jsx(ne,{id:"notes",placeholder:"Informe detalhes importantes para o terapeuta",className:"mt-2",value:H,onChange:s=>Q(s.target.value)})]})]}),e.jsxs(oe,{children:[e.jsx(u,{variant:"outline",onClick:()=>y(!1),children:"Cancelar"}),e.jsx(u,{onClick:J,children:"Confirmar"})]})]})})]})}export{ke as default};
