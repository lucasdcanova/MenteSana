import{c as H,l as Ce,n as I,r as l,j as e,T as Se,O as Te,o as q,W as Me,p as Pe,q as Re,S as _e,s as Oe,D as $e,t as V,R as ke,v as Fe,w as m,x as B,u as Le,d as ze,b as He,y as Ie,z as _,A as D,B as A,E as qe,F as Ve,k as O,G as Be,C as Ke,h as Ue,H as Ge,L as Qe,I as We,J as $,K as M,M as Je}from"./index-DKFI7ZyH.js";import{S as k,a as F,b as L,c as z,d as w}from"./select-DV2zMmnw.js";import{P as Ye}from"./plus-BTDcvFex.js";import{V as Xe}from"./volume-x-BilrSJ53.js";import{T as Ze}from"./trash-B_pc7RHv.js";import"./chevron-down-VAhjCEtL.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=H("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=H("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);var K="AlertDialog",[sa,Aa]=Ce(K,[I]),d=I(),U=s=>{const{__scopeAlertDialog:t,...o}=s,n=d(t);return e.jsx(ke,{...n,...o,modal:!0})};U.displayName=K;var ta="AlertDialogTrigger",oa=l.forwardRef((s,t)=>{const{__scopeAlertDialog:o,...n}=s,i=d(o);return e.jsx(Se,{...i,...n,ref:t})});oa.displayName=ta;var ra="AlertDialogPortal",G=s=>{const{__scopeAlertDialog:t,...o}=s,n=d(t);return e.jsx(Fe,{...n,...o})};G.displayName=ra;var la="AlertDialogOverlay",Q=l.forwardRef((s,t)=>{const{__scopeAlertDialog:o,...n}=s,i=d(o);return e.jsx(Te,{...i,...n,ref:t})});Q.displayName=la;var f="AlertDialogContent",[na,ia]=sa(f),W=l.forwardRef((s,t)=>{const{__scopeAlertDialog:o,children:n,...i}=s,g=d(o),p=l.useRef(null),h=q(t,p),j=l.useRef(null);return e.jsx(Me,{contentName:f,titleName:J,docsSlug:"alert-dialog",children:e.jsx(na,{scope:o,cancelRef:j,children:e.jsxs(Pe,{role:"alertdialog",...g,...i,ref:h,onOpenAutoFocus:Re(i.onOpenAutoFocus,u=>{var b;u.preventDefault(),(b=j.current)==null||b.focus({preventScroll:!0})}),onPointerDownOutside:u=>u.preventDefault(),onInteractOutside:u=>u.preventDefault(),children:[e.jsx(_e,{children:n}),e.jsx(da,{contentRef:p})]})})})});W.displayName=f;var J="AlertDialogTitle",Y=l.forwardRef((s,t)=>{const{__scopeAlertDialog:o,...n}=s,i=d(o);return e.jsx(Oe,{...i,...n,ref:t})});Y.displayName=J;var X="AlertDialogDescription",Z=l.forwardRef((s,t)=>{const{__scopeAlertDialog:o,...n}=s,i=d(o);return e.jsx($e,{...i,...n,ref:t})});Z.displayName=X;var ca="AlertDialogAction",ee=l.forwardRef((s,t)=>{const{__scopeAlertDialog:o,...n}=s,i=d(o);return e.jsx(V,{...i,...n,ref:t})});ee.displayName=ca;var ae="AlertDialogCancel",se=l.forwardRef((s,t)=>{const{__scopeAlertDialog:o,...n}=s,{cancelRef:i}=ia(ae,o),g=d(o),p=q(t,i);return e.jsx(V,{...g,...n,ref:p})});se.displayName=ae;var da=({contentRef:s})=>{const t=`\`${f}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${f}\` by passing a \`${X}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${f}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return l.useEffect(()=>{var n;document.getElementById((n=s.current)==null?void 0:n.getAttribute("aria-describedby"))||console.warn(t)},[t,s]),null},ua=U,ma=G,te=Q,oe=W,re=ee,le=se,ne=Y,ie=Z;const pa=ua,xa=ma,ce=l.forwardRef(({className:s,...t},o)=>e.jsx(te,{className:m("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:o}));ce.displayName=te.displayName;const de=l.forwardRef(({className:s,...t},o)=>e.jsxs(xa,{children:[e.jsx(ce,{}),e.jsx(oe,{ref:o,className:m("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t})]}));de.displayName=oe.displayName;const ue=({className:s,...t})=>e.jsx("div",{className:m("flex flex-col space-y-2 text-center sm:text-left",s),...t});ue.displayName="AlertDialogHeader";const me=({className:s,...t})=>e.jsx("div",{className:m("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});me.displayName="AlertDialogFooter";const pe=l.forwardRef(({className:s,...t},o)=>e.jsx(ne,{ref:o,className:m("text-lg font-semibold",s),...t}));pe.displayName=ne.displayName;const xe=l.forwardRef(({className:s,...t},o)=>e.jsx(ie,{ref:o,className:m("text-sm text-muted-foreground",s),...t}));xe.displayName=ie.displayName;const fe=l.forwardRef(({className:s,...t},o)=>e.jsx(re,{ref:o,className:m(B(),s),...t}));fe.displayName=re.displayName;const ge=l.forwardRef(({className:s,...t},o)=>e.jsx(le,{ref:o,className:m(B({variant:"outline"}),"mt-2 sm:mt-0",s),...t}));ge.displayName=le.displayName;function wa(){const[s,t]=l.useState("all"),[o,n]=l.useState("all"),[i,g]=l.useState({}),[p,h]=l.useState(null),[j,u]=l.useState(null),[b,C]=l.useState(!1),{user:he}=Le(),[fa,P]=ze(),{toast:v}=He(),{data:c,isLoading:N,error:je,refetch:ga}=Ie({queryKey:["/api/journal-entries/user"],queryFn:Je(),enabled:!!he}),ve=_({mutationFn:async a=>(await We("POST",`/api/journal/${a}/process`,{})).json(),onSuccess:()=>{v({title:"Entrada processada",description:"A entrada foi categorizada e recebeu um t√≠tulo.",variant:"default"}),$.invalidateQueries({queryKey:["/api/journal-entries/user"]}),h(null)},onError:a=>{v({title:"Erro no processamento",description:"N√£o foi poss√≠vel processar a entrada. Tente novamente mais tarde.",variant:"destructive"}),h(null),console.error("Erro ao processar entrada:",a)}}),Ne=_({mutationFn:async a=>{console.log(`Excluindo entrada do di√°rio com ID: ${a}`);const r=localStorage.getItem("authToken"),x=r?{Authorization:r}:{},y=await fetch(`/api/journal/${a}`,{method:"DELETE",headers:x,credentials:"include"});if(console.log(`Resposta da exclus√£o: Status ${y.status}`),y.status===204||y.status===200)return{success:!0};try{const T=await y.json();return console.error("Erro detalhado:",T),T}catch{return{success:!1,error:`Status: ${y.status}`}}},onSuccess:()=>{v({title:"Entrada exclu√≠da",description:"A entrada foi exclu√≠da com sucesso.",variant:"default"}),$.invalidateQueries({queryKey:["/api/journal-entries/user"]}),u(null)},onError:a=>{v({title:"Erro na exclus√£o",description:"N√£o foi poss√≠vel excluir a entrada. Tente novamente mais tarde.",variant:"destructive"}),console.error("Erro ao excluir entrada:",a)}}),ye=a=>{u(a),C(!0)},De=()=>{j&&(Ne.mutate(j),C(!1))},E={};c!=null&&c.data&&c.data.forEach(a=>{const r=new Date(a.date),x=D(r,"yyyy-MM");D(r,"MMMM yyyy",{locale:M}),E[x]||(E[x]=[]),E[x].push(a)});const Ae=Object.keys(E).map(a=>({value:a,label:D(new Date(a+"-01"),"MMMM yyyy",{locale:M})})).sort((a,r)=>r.value.localeCompare(a.value)),S=c!=null&&c.data?c.data.filter(a=>{if(o&&o!=="all"){const r=new Date(a.date);if(D(r,"yyyy-MM")!==o)return!1}return!(s!=="all"&&(s==="text"&&a.audioUrl||s==="audio"&&!a.audioUrl))}).sort((a,r)=>new Date(r.date).getTime()-new Date(a.date).getTime()):[],we=a=>{const r=new Date(a);return D(r,"d 'de' MMMM '√†s' HH:mm",{locale:M})},be=(a,r=150)=>a.length<=r?a:a.slice(0,r)+"...",Ee=a=>({alegre:"üòä",calmo:"üòå",motivado:"üöÄ",grato:"üôè",neutro:"üòê",ansioso:"üò∞",triste:"üò¢",raiva:"üò°",frustrado:"üò§",confuso:"üòï"})[a]||"üòê",R=a=>{h(a),g(r=>({...r,[a]:!0})),ve.mutate(a)};return l.useEffect(()=>{if(c!=null&&c.data&&!N){const a=c.data.filter(r=>r.needsProcessing);if(a.length>0&&!p){v({title:"Processando entradas",description:`${a.length} ${a.length===1?"entrada precisa":"entradas precisam"} de processamento.`,variant:"default"});const r=a[0];R(r.id)}}},[c,N,p]),e.jsxs("div",{className:"container px-4 md:px-6 py-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Hist√≥rico do Di√°rio"}),e.jsxs(A,{className:"rounded-full",onClick:()=>P("/journal"),children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:"Nova Entrada"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-center",children:[e.jsx("div",{className:"flex-1",children:e.jsxs(k,{value:o,onValueChange:a=>n(a),children:[e.jsxs(F,{className:"w-full rounded-xl",children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),e.jsx(L,{placeholder:"Filtrar por m√™s"})]}),e.jsxs(z,{children:[e.jsx(w,{value:"all",children:"Todos os meses"}),Ae.map(a=>e.jsx(w,{value:a.value,children:a.label},a.value))]})]})}),e.jsx("div",{className:"flex-1",children:e.jsxs(k,{value:s,onValueChange:a=>t(a),children:[e.jsxs(F,{className:"w-full rounded-xl",children:[e.jsx(aa,{className:"w-4 h-4 mr-2"}),e.jsx(L,{placeholder:"Filtrar por tipo"})]}),e.jsxs(z,{children:[e.jsx(w,{value:"all",children:"Todos os tipos"}),e.jsx(w,{value:"text",children:"Apenas texto"}),e.jsx(w,{value:"audio",children:"Apenas √°udio"})]})]})})]}),e.jsx(Ve,{className:"my-2"}),N&&e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(O,{className:"w-8 h-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-2",children:"Carregando entradas..."})]}),je&&e.jsx("div",{className:"bg-red-50 text-red-500 p-4 rounded-lg text-center",children:e.jsx("p",{children:"Erro ao carregar as entradas. Tente novamente mais tarde."})}),!N&&S.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ea,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Nenhuma entrada encontrada"}),e.jsxs("p",{className:"text-gray-500 mb-6",children:[s||o?"Tente ajustar os filtros ou ":"Comece a registrar seus pensamentos e sentimentos. ",e.jsx(A,{variant:"link",className:"p-0 h-auto text-primary",onClick:()=>P("/journal"),children:"criar uma nova entrada"})]})]}),!N&&S.length>0&&e.jsx(Be,{className:"h-[calc(100vh-220px)]",children:e.jsx("div",{className:"space-y-4 pr-4",children:S.map(a=>e.jsxs(Ke,{className:"relative overflow-hidden border-0 shadow-md hover:shadow-lg transition-shadow",style:{borderLeft:`4px solid ${a.colorHex||"#4f46e5"}`},children:[e.jsxs("div",{className:"absolute top-3 right-3 flex gap-1.5",children:[a.audioUrl&&e.jsx("span",{className:"bg-blue-500 text-white text-xs px-2 py-1 rounded-full",children:"√Åudio"}),a.needsProcessing&&e.jsx("span",{className:"bg-amber-500 text-white text-xs px-2 py-1 rounded-full flex items-center",children:i[a.id]?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-3 h-3 mr-1 animate-spin"}),"Processando"]}):"Aguardando processamento"})]}),e.jsx(Ue,{className:"pt-6 pb-2",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold line-clamp-1",children:a.title||a.category||"Entrada sem t√≠tulo"}),e.jsx("span",{className:"text-xs text-gray-500",children:we(a.date)})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("span",{className:"inline-flex items-center bg-gray-100 px-2 py-0.5 rounded-full text-sm",children:[Ee(a.mood)," ",a.mood]}),a.category&&e.jsx("span",{className:"inline-flex items-center bg-gray-100 px-2 py-0.5 rounded-full text-sm",children:a.category}),a.tags&&a.tags.slice(0,2).map(r=>e.jsxs("span",{className:"inline-flex items-center bg-gray-100 px-2 py-0.5 rounded-full text-sm",children:["#",r]},r))]}),e.jsx("p",{className:"text-gray-600 line-clamp-3",children:be(a.content)}),a.audioUrl&&e.jsx("div",{className:"pt-2",children:e.jsxs("audio",{controls:!0,className:"w-full h-8",src:a.audioUrl,controlsList:"nodownload",children:[e.jsx(Xe,{className:"w-4 h-4 mr-1"}),"Seu navegador n√£o suporta √°udio"]})})]})}),e.jsxs(Ge,{className:"pt-0 pb-4 flex justify-between",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(Qe,{to:`/journal/${a.id}`,children:e.jsx(A,{variant:"ghost",size:"sm",className:"mt-2",children:"Ver detalhes"})}),e.jsxs(A,{variant:"ghost",size:"sm",className:"mt-2 text-red-500 hover:text-red-700 hover:bg-red-50",onClick:()=>ye(a.id),children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Excluir"]})]}),a.needsProcessing&&!i[a.id]&&e.jsx(A,{variant:"outline",size:"sm",className:"mt-2",onClick:()=>R(a.id),children:"Processar agora"})]})]},a.id))})})]}),e.jsx(pa,{open:b,onOpenChange:C,children:e.jsxs(de,{children:[e.jsxs(ue,{children:[e.jsx(pe,{children:"Confirma√ß√£o de exclus√£o"}),e.jsx(xe,{children:"Tem certeza que deseja excluir esta entrada do di√°rio? Esta a√ß√£o n√£o pode ser desfeita."})]}),e.jsxs(me,{children:[e.jsx(ge,{children:"Cancelar"}),e.jsx(fe,{onClick:De,className:"bg-red-500 text-white hover:bg-red-600",children:"Excluir"})]})]})})]})}export{wa as default};
